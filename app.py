from flask import Flask, render_template, request, jsonify
import pickle
import pandas as pd
from flask import Flask, send_from_directory

app = Flask(__name__)

# Load the model
with open('Trained_Model/model.pkl', 'rb') as file:
    model = pickle.load(file)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/predict', methods=['POST'])
def predict():
    # Get data from POST request
    data = request.get_json(force=True)

    # Encoding for 'suburb' feature
    suburb_encoding = {
    'Abbotsford ':0,
    'Aberfeldie ':1,
    'Airport West ':2,
    'Albanvale ':3,
    'Albert Park ':4,
    'Albion ':5,
    'Alphington ':6,
    'Altona ':7,
    'Altona Meadows ':8,
    'Altona North ':9,
    'Ardeer ':10,
    'Armadale ':11,
    'Ascot Vale ':12,
    'Ashburton ':13,
    'Ashwood ':14,
    'Aspendale ':15,
    'Aspendale Gardens ':16,
    'Attwood ':17,
    'Avondale Heights ':18,
    'Bacchus Marsh ':19,
    'Balaclava ':20,
    'Balwyn ':21,
    'Balwyn North ':22,
    'Bayswater ':23,
    'Bayswater North ':24,
    'Beaconsfield ':25,
    'Beaconsfield Upper ':26,
    'Beaumaris ':27,
    'Bellfield ':28,
    'Bentleigh ':29,
    'Bentleigh East ':30,
    'Berwick ':31,
    'Black Rock ':32,
    'Blackburn ':33,
    'Blackburn North ':34,
    'Blackburn South ':35,
    'Bonbeach ':36,
    'Boronia ':37,
    'Botanic Ridge ':38,
    'Box Hill ':39,
    'Braybrook ':40,
    'Briar Hill ':41,
    'Brighton ':42,
    'Brighton East ':43,
    'Broadmeadows ':44,
    'Brookfield ':45,
    'Brooklyn ':46,
    'Brunswick ':47,
    'Brunswick East ':48,
    'Brunswick West ':49,
    'Bulleen ':50,
    'Bullengarook ':51,
    'Bundoora ':52,
    'Burnley ':53,
    'Burnside ':54,
    'Burnside Heights ':55,
    'Burwood ':56,
    'Burwood East ':57,
    'Cairnlea ':58,
    'Camberwell ':59,
    'Campbellfield ':60,
    'Canterbury ':61,
    'Carlton ':62,
    'Carlton North ':63,
    'Carnegie ':64,
    'Caroline Springs ':65,
    'Carrum ':66,
    'Carrum Downs ':67,
    'Caulfield ':68,
    'Caulfield East ':69,
    'Caulfield North ':70,
    'Caulfield South ':71,
    'Chadstone ':72,
    'Chelsea ':73,
    'Chelsea Heights ':74,
    'Cheltenham ':75,
    'Chirnside Park ':76,
    'Clarinda ':77,
    'Clayton ':78,
    'Clayton South ':79,
    'Clifton Hill ':80,
    'Coburg ':81,
    'Coburg North ':82,
    'Coldstream ':83,
    'Collingwood ':84,
    'Coolaroo ':85,
    'Craigieburn ':86,
    'Cranbourne ':87,
    'Cranbourne North ':88,
    'Cranbourne West ':89,
    'Cremorne ':90,
    'Croydon ':91,
    'Croydon Hills ':92,
    'Croydon North ':93,
    'Croydon South ':94,
    'Dallas ':95,
    'Dandenong ':96,
    'Dandenong North ':97,
    'Deepdene ':98,
    'Deer Park ':99,
    'Delahey ':100,
    'Derrimut ':101,
    'Diamond Creek ':102,
    'Diggers Rest ':103,
    'Dingley Village ':104,
    'Docklands ':105,
    'Doncaster ':106,
    'Doncaster East ':107,
    'Donvale ':108,
    'Doreen ':109,
    'Doveton ':110,
    'Eaglemont ':111,
    'East Melbourne ':112,
    'Edithvale ':113,
    'Elsternwick ':114,
    'Eltham ':115,
    'Eltham North ':116,
    'Elwood ':117,
    'Emerald ':118,
    'Endeavour Hills ':119,
    'Epping ':120,
    'Essendon ':121,
    'Essendon North ':122,
    'Essendon West ':123,
    'Eumemmerring ':124,
    'Fairfield ':125,
    'Fawkner ':126,
    'Ferntree Gully ':127,
    'Fitzroy ':128,
    'Fitzroy North ':129,
    'Flemington ':130,
    'Footscray ':131,
    'Forest Hill ':132,
    'Frankston ':133,
    'Frankston North ':134,
    'Frankston South ':135,
    'Gardenvale ':136,
    'Gisborne ':137,
    'Gisborne South ':138,
    'Gladstone Park ':139,
    'Glen Huntly ':140,
    'Glen Iris ':141,
    'Glen Waverley ':142,
    'Glenroy ':143,
    'Gowanbrae ':144,
    'Greensborough ':145,
    'Greenvale ':146,
    'Hadfield ':147,
    'Hallam ':148,
    'Hampton ':149,
    'Hampton East ':150,
    'Hampton Park ':151,
    'Hawthorn ':152,
    'Hawthorn East ':153,
    'Healesville ':154,
    'Heatherton ':155,
    'Heathmont ':156,
    'Heidelberg ':157,
    'Heidelberg Heights ':158,
    'Heidelberg West ':159,
    'Highett ':160,
    'Hillside ':161,
    'Hoppers Crossing ':162,
    'Hughesdale ':163,
    'Huntingdale ':164,
    'Hurstbridge ':165,
    'Ivanhoe ':166,
    'Ivanhoe East ':167,
    'Jacana ':168,
    'Kalkallo ':169,
    'Kealba ':170,
    'Keilor ':171,
    'Keilor Downs ':172,
    'Keilor East ':173,
    'Keilor Lodge ':174,
    'Keilor Park ':175,
    'Kensington ':176,
    'Kew ':177,
    'Kew East ':178,
    'Keysborough ':179,
    'Kilsyth ':180,
    'Kings Park ':181,
    'Kingsbury ':182,
    'Kingsville ':183,
    'Knoxfield ':184,
    'Kooyong ':185,
    'Kurunjang ':186,
    'Lalor ':187,
    'Langwarrin ':188,
    'Laverton ':189,
    'Lilydale ':190,
    'Lower Plenty ':191,
    'Lysterfield ':192,
    'Maidstone ':193,
    'Malvern ':194,
    'Malvern East ':195,
    'Maribyrnong ':196,
    'McKinnon ':197,
    'Meadow Heights ':198,
    'Melbourne ':199,
    'Melton ':200,
    'Melton South ':201,
    'Melton West ':202,
    'Mentone ':203,
    'Mernda ':204,
    'Mickleham ':205,
    'Middle Park ':206,
    'Mill Park ':207,
    'Mitcham ':208,
    'Monbulk ':209,
    'Mont Albert ':210,
    'Montmorency ':211,
    'Montrose ':212,
    'Moonee Ponds ':213,
    'Moorabbin ':214,
    'Mooroolbark ':215,
    'Mordialloc ':216,
    'Mount Evelyn ':217,
    'Mount Waverley ':218,
    'Mulgrave ':219,
    'Murrumbeena ':220,
    'Narre Warren ':221,
    'New Gisborne ':222,
    'Newport ':223,
    'Niddrie ':224,
    'Noble Park ':225,
    'North Melbourne ':226,
    'North Warrandyte ':227,
    'Northcote ':228,
    'Notting Hill ':229,
    'Nunawading ':230,
    'Oak Park ':231,
    'Oakleigh ':232,
    'Oakleigh East ':233,
    'Oakleigh South ':234,
    'Officer ':235,
    'Ormond ':236,
    'Pakenham ':237,
    'Parkdale ':238,
    'Parkville ':239,
    'Pascoe Vale ':240,
    'Patterson Lakes ':241,
    'Plenty ':242,
    'Plumpton ':243,
    'Point Cook ':244,
    'Port Melbourne ':245,
    'Prahran ':246,
    'Preston ':247,
    'Princes Hill ':248,
    'Research ':249,
    'Reservoir ':250,
    'Richmond ':251,
    'Riddells Creek ':252,
    'Ringwood ':253,
    'Ringwood East ':254,
    'Ringwood North ':255,
    'Ripponlea ':256,
    'Rockbank ':257,
    'Rosanna ':258,
    'Rowville ':259,
    'Roxburgh Park ':260,
    'Sandhurst ':261,
    'Sandringham ':262,
    'Scoresby ':263,
    'Seabrook ':264,
    'Seaford ':265,
    'Seaholme ':266,
    'Seddon ':267,
    'Silvan ':268,
    'Skye ':269,
    'South Kingsville ':270,
    'South Melbourne ':271,
    'South Morang ':272,
    'South Yarra ':273,
    'Southbank ':274,
    'Spotswood ':275,
    'Springvale ':276,
    'Springvale South ':277,
    'St Albans ':278,
    'St Helena ':279,
    'St Kilda ':280,
    'Strathmore ':281,
    'Strathmore Heights ':282,
    'Sunbury ':283,
    'Sunshine ':284,
    'Sunshine North ':285,
    'Sunshine West ':286,
    'Surrey Hills ':287,
    'Sydenham ':288,
    'Tarneit ':289,
    'Taylors Hill ':290,
    'Taylors Lakes ':291,
    'Templestowe ':292,
    'Templestowe Lower ':293,
    'The Basin ':294,
    'Thomastown ':295,
    'Thornbury ':296,
    'Toorak ':297,
    'Travancore ':298,
    'Truganina ':299,
    'Tullamarine ':300,
    'Upwey ':301,
    'Vermont ':302,
    'Vermont South ':303,
    'Viewbank ':304,
    'Wallan ':305,
    'Wandin North ':306,
    'Wantirna ':307,
    'Wantirna South ':308,
    'Warrandyte ':309,
    'Warranwood ':310,
    'Waterways ':311,
    'Watsonia ':312,
    'Watsonia North ':313,
    'Wattle Glen ':314,
    'Werribee ':315,
    'Werribee South ':316,
    'West Footscray ':317,
    'West Melbourne ':318,
    'Westmeadows ':319,
    'Wheelers Hill ':320,
    'Whittlesea ':321,
    'Wildwood ':322,
    'Williams Landing ':323,
    'Williamstown ':324,
    'Williamstown North ':325,
    'Windsor ':326,
    'Wollert ':327,
    'Wonga Park ':328,
    'Wyndham Vale ':329,
    'Yallambie ':330,
    'Yarra Glen ':331,
    'Yarraville ':332

    }
    encoded_suburb = suburb_encoding[data['suburb']]

    # Encoding for 'type' feature
    type_encoding = {
    'House': 0,
    'Townhouse': 1,
    'Unit': 2
    }
    encoded_type = type_encoding[data['type']]

    # Encoding for 'region' feature
    region_encoding = {
        'Eastern Metropolitan': 0,
        'Eastern Victoria': 1,
        'Northern Metropolitan': 2,
        'Northern Victoria': 3,
        'South-Eastern Metropolitan': 4,
        'Southern Metropolitan': 5,
        'Western Metropolitan': 6,
        'Western Victoria': 7,
    }
    encoded_region = region_encoding[data['region']]

    # Prepare data for prediction
    prediction_data = pd.DataFrame({
        'Suburb': [encoded_suburb],
        'Rooms': [data['rooms']],
        'Type': [encoded_type],
        'Distance': [data['distance']],
        'Bathroom': [data['bathroom']],
        'Car': [data['garage']],
        'Region': [encoded_region]
    })

    # Make prediction
    prediction = model.predict(prediction_data)[0]
    formatted_prediction = "${:,.2f}".format(prediction)
    return jsonify(result=formatted_prediction)

if __name__ == '__main__':
    app.run(debug=True) 